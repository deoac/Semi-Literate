<!doctype html>
<html lang="en">
<head>
<title>An implementation of Semi-Literate programming for Raku with Pod6</title>
<meta charset="UTF-8" />

<link href="/asset_files/images/favicon.ico" rel="icon" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="asset_files/css/rakudoc-extra.css" />
<link rel="stylesheet" type="text/css" href="asset_files/css/rakudoc-styling.css" />
<link rel="stylesheet" type="text/css" href="asset_files/css/font-awesome.min.css" />

</head>
	<body class="pod">
<header>
<img id="Camelia_bug" src="/asset_files/images/Camelia.svg"><h1 class="title">An implementation of Semi-Literate programming for Raku with Pod6</h1></header><div class="pod-content"><nav><div id="_TOC"><table>
<caption>Table of Contents</caption>
<tr class="toc-level-1"><td class="toc-text"><a href="#INTRODUCTION">INTRODUCTION</a></td></tr>
 <tr class="toc-level-1"><td class="toc-text"><a href="#The_Grammar">The Grammar</a></td></tr>
 <tr class="toc-level-2"><td class="toc-text"><a href="#The_Pod6_delimiters">The Pod6 delimiters</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#The_begin-pod_token">The begin-pod token</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#The_end-pod_token">The end-pod token</a></td></tr>
 <tr class="toc-level-2"><td class="toc-text"><a href="#Replacing_Pod6_sections_with_blank_lines">Replacing Pod6 sections with blank lines</a></td></tr>
 <tr class="toc-level-2"><td class="toc-text"><a href="#The_Pod_token">The Pod token</a></td></tr>
 <tr class="toc-level-2"><td class="toc-text"><a href="#The_Code_tokens">The Code tokens</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#Woven_sections">Woven sections</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#Non-woven_sections">Non-woven sections</a></td></tr>
 <tr class="toc-level-4"><td class="toc-text"><a href="#One_line_of_code">One line of code</a></td></tr>
 <tr class="toc-level-4"><td class="toc-text"><a href="#Delimited_blocks_of_code">Delimited blocks of code</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#The_plain-line_token">The plain-line token</a></td></tr>
 <tr class="toc-level-1"><td class="toc-text"><a href="#The_Tangle_subroutine">The Tangle subroutine</a></td></tr>
 <tr class="toc-level-2"><td class="toc-text"><a href="#Clean_the_source">Clean the source</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#Remove_unnecessary_blank_lines">Remove unnecessary blank lines</a></td></tr>
 <tr class="toc-level-2"><td class="toc-text"><a href="#The_interesting_stuff">The interesting stuff</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#Replace_Pod6_sections_with_blank_lines">Replace Pod6 sections with blank lines</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#Remove_the_no-weave_delimiters">Remove the no-weave delimiters</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#remove_blank_lines_at_the_end">remove blank lines at the end</a></td></tr>
 <tr class="toc-level-1"><td class="toc-text"><a href="#The_Weave_subroutine">The Weave subroutine</a></td></tr>
 <tr class="toc-level-2"><td class="toc-text"><a href="#The_parameters_of_Weave">The parameters of Weave</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#$input-file">$input-file</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#$line-numbers">$line-numbers</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#$verbose_Use_verbose_only_for_debugging">$verbose Use verbose only for debugging</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#Remove_blank_lines_at_the_begining_and_end_of_the_code">Remove blank lines at the begining and end of the code</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#remove_blank_lines_at_the_end_of_the_code">remove blank lines at the end of the code</a></td></tr>
 <tr class="toc-level-2"><td class="toc-text"><a href="#Interesting_stuff">Interesting stuff</a></td></tr>
 <tr class="toc-level-3"><td class="toc-text"><a href="#Remove_unseemly_blank_lines">Remove unseemly blank lines</a></td></tr>
 <tr class="toc-level-1"><td class="toc-text"><a href="#NAME">NAME</a></td></tr>
 <tr class="toc-level-1"><td class="toc-text"><a href="#VERSION">VERSION</a></td></tr>
 <tr class="toc-level-1"><td class="toc-text"><a href="#SYNOPSIS">SYNOPSIS</a></td></tr>
 <tr class="toc-level-1"><td class="toc-text"><a href="#DESCRIPTION">DESCRIPTION</a></td></tr>
 <tr class="toc-level-2"><td class="toc-text"><a href="#Influences">Influences</a></td></tr>
 <tr class="toc-level-1"><td class="toc-text"><a href="#DEPENDENCIES">DEPENDENCIES</a></td></tr>
 <tr class="toc-level-1"><td class="toc-text"><a href="#BUGS_AND_LIMITATIONS">BUGS AND LIMITATIONS</a></td></tr>
 <tr class="toc-level-1"><td class="toc-text"><a href="#AUTHOR">AUTHOR</a></td></tr>
 <tr class="toc-level-1"><td class="toc-text"><a href="#LICENSE_AND_COPYRIGHT">LICENSE AND COPYRIGHT</a></td></tr>
</table></div>
</nav><div id=""></div><div class="pod-body">
<section name="___top">
<h1 id="INTRODUCTION"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">INTRODUCTION</a></h1>
<p>I want to create a semi-literate Raku source file with the extension <code>.sl</code>. Then, I will <em>weave</em> it to generate a readable file in formats like Markdown, PDF, HTML, and more. Additionally, I will <em>tangle</em> it to create source code without any Pod6.</p><p>To do this, I need to divide the file into <code>Pod</code> and <code>Code</code> sections by parsing it. For this purpose, I will create a dedicated Grammar.</p><p>(See <a href="https://github.com/deoac/Useful-Regexes">Useful::Regexes</a> for the definitions of the named regexes used here. (<code>hws</code> == Horizontal WhiteSpace))</p>
<h1 id="The_Grammar"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">The Grammar</a></h1>
</section>
<section name="pod"><pre class="pod-block-code">    3| grammar Semi::Literate is export does Useful::Regexes {
</pre></section>
<section name="pod"><p>Our file will exclusively consist of <code>Pod</code> or <code>Code</code> sections, and nothing else. The <code>Code</code> sections are of two types, a) code that is woven into the documentation, and b) code that is not woven into the documentation. The <code>TOP</code> token clearly indicates this.</p></section>
<section name="pod"><pre class="pod-block-code">    4|     token TOP {
    5|         [
    6|           || &lt;pod&gt;
    7|           || &lt;code&gt;
    8|         ]*
    9|     } 
   10| 
   11|     token code  {
   12|         [
   13|           || &lt;non-woven&gt;+
   14|           || &lt;woven&gt;+
   15|         ]
   16|     } 
</pre></section>
<section name="pod">
<h2 id="The_Pod6_delimiters"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">The Pod6 delimiters</a></h2>
<p>According to the <a href="https://docs.raku.org/language/pod">documentation</a>,</p><dl>
<dt>Every Pod6 document has to begin with C&lt;=begin pod&gt; and end with C&lt;=end&gt; pod.</dt><dd></dd>
</dl><p>So let's define those tokens.</p>
<h3 id="The_begin-pod_token"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">The <code>begin-pod</code> token</a></h3>
</section>
<section name="pod"><pre class="pod-block-code">   17|     token begin-pod {
   18|         &lt;leading-ws&gt;
   19|         '=' begin &lt;hws&gt; pod
   20|         &lt;ws-till-EOL&gt;
   21|     } 
</pre></section>
<section name="pod">
<h3 id="The_end-pod_token"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">The <code>end-pod</code> token</a></h3>
<p>The <code>end-pod</code> token is much simpler.</p></section>
<section name="pod"><pre class="pod-block-code">   22|     token end-pod  {
   23|         &lt;leading-ws&gt;
   24|         '=' end &lt;hws&gt; pod
   25|         &lt;ws-till-EOL&gt;
   26|     } 
</pre></section>
<section name="pod">
<h2 id="Replacing_Pod6_sections_with_blank_lines"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">Replacing Pod6 sections with blank lines</a></h2>
<p>When we <em>tangle</em> the semi-literate code, all the Pod6 will be removed. This would leave a lot of blank lines in the Raku code. So we'll clean it up. We provide the option for users to specify the number of empty lines that should replace a <code>pod</code> block. To do this, simply add a Pod6 comment immediately after the <code>=begin pod</code> statement. The comment can say anything you like, but must end with a digit specifying the number of blank lines with which to replace the Pod6 section.</p><pre class="pod-block-code">    =begin pod
    =comment I want this pod block replaced by only one line 1
    ...
    =end pod
</pre><p>Here's the relevant regex:</p></section>
<section name="pod"><pre class="pod-block-code">   27|     token blank-line-comment {
   28|         &lt;leading-ws&gt;
   29|         '=' comment
   30|         \N*?
   31|         $&lt;num-blank-lines&gt; = (\d+)?
   32|         &lt;ws-till-EOL&gt;
   33|     } 
</pre></section>
<section name="pod">
<h2 id="The_Pod_token"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">The <code>Pod</code> token</a></h2>
<p>Within the delimiters, all lines are considered documentation. We will refer to these lines as <code>plain-lines</code>. Additionally, it is possible to have nested <code>Pod</code> sections. This allows for a hierarchical organization of documentation, allowing for more structured and detailed explanations.</p><p>It is also permissible for the block to be empty. Therefore, we will use the 'zero-or-more' quantifier on the lines of documentation, allowing for the possibility of having no lines in the block.</p></section>
<section name="pod"><pre class="pod-block-code">   34|     token pod {
   35|         &lt;.begin-pod&gt;
   36|         &lt;blank-line-comment&gt;?
   37|             [&lt;pod&gt; | &lt;.plain-line&gt;]*
   38|         &lt;.end-pod&gt;
   39|     } 
</pre></section>
<section name="pod">
<h2 id="The_Code_tokens"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">The <code>Code</code> tokens</a></h2>
<p>The <code>Code</code> sections are similarly easily defined. There are two types of <code>Code</code> sections, depending on whether they will appear in the woven code.</p>
<h3 id="Woven_sections"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">Woven sections</a></h3>
<p>These sections are trivially defined. They are just one or more <code>plain-line</code>s.</p></section>
<section name="pod"><pre class="pod-block-code">   40|     token woven  {
   41|         [
   42|             || &lt;.plain-line&gt;
   43|         ]+
   44|     } 
</pre></section>
<section name="pod">
<h3 id="Non-woven_sections"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">Non-woven sections</a></h3>
<p>Sometimes there will be code you do not want woven into the documentation, such as boilerplate code like <code>use v6.d;</code>. You have two options to mark such code. By individual lines or by a delimited block of code.</p></section>
<section name="pod"><pre class="pod-block-code">   45|     token non-woven {
   46|         [
   47|           || &lt;.one-line-no-weave&gt;
   48|           || &lt;.delimited-no-weave&gt;
   49|         ]+
   50|     } 
</pre></section>
<section name="pod">
<h4 id="One_line_of_code"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">One line of code</a></h4>
<p>Simply append <code># no-weave-this-line</code> at the end of the line!</p></section>
<section name="pod"><pre class="pod-block-code">   51|     regex one-line-no-weave {
   52|         $&lt;the-code&gt;=(&lt;leading-ws&gt; &lt;optional-chars&gt;)
   53|         '#' &lt;hws&gt; 'no-weave-this-line'
   54|         &lt;ws-till-EOL&gt;
   55|     } 
</pre></section>
<section name="pod">
<h4 id="Delimited_blocks_of_code"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">Delimited blocks of code</a></h4>
<p>Simply add comments <code># begin-no-weave</code> and <code>#end-no-weave</code> before and after the code you want ignored in the formatted document.</p></section>
<section name="pod"><pre class="pod-block-code">   56|     token begin-no-weave {
   57|         &lt;leading-ws&gt;
   58|         '#' &lt;hws&gt; 'begin-no-weave'
   59|         &lt;ws-till-EOL&gt;
   60|     } 
   61| 
   62|     token end-no-weave {
   63|         &lt;leading-ws&gt;
   64|         '#' &lt;hws&gt; 'end-no-weave'
   65|         &lt;ws-till-EOL&gt;
   66|     } 
   67| 
   68|     token delimited-no-weave {
   69|         &lt;.begin-no-weave&gt;
   70|             &lt;.plain-line&gt;*
   71|         &lt;.end-no-weave&gt;
   72|     } 
</pre></section>
<section name="pod">
<h3 id="The_plain-line_token"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">The <code>plain-line</code> token</a></h3>
<p>The <code>plain-line</code> token is, really, any line at all... ... except for one subtlety. They it can't be one of the begin/end delimiters. We can specify that with a <a href="https://docs.raku.org/language/regexes\#Regex_Boolean_condition_check">Regex Boolean Condition Check</a>.</p></section>
<section name="pod"><pre class="pod-block-code">   73|     token plain-line {
   74|         :my $*EXCEPTION = False;
   75|         [
   76|           ||  &lt;.begin-pod&gt;         { $*EXCEPTION = True }
   77|           ||  &lt;.end-pod&gt;           { $*EXCEPTION = True }
   78|           ||  &lt;.begin-no-weave&gt;    { $*EXCEPTION = True }
   79|           ||  &lt;.end-no-weave&gt;      { $*EXCEPTION = True }
   80|           ||  &lt;.one-line-no-weave&gt; { $*EXCEPTION = True }
   81|           || [^^ &lt;rest-of-line&gt;]
   82|         ]
   83|         &lt;?{ !$*EXCEPTION }&gt;
   84|     } 
</pre></section>
<section name="pod"><p>And that concludes the grammar for separating <code>Pod</code> from <code>Code</code>!</p></section>
<section name="pod"><pre class="pod-block-code">   85| } 
</pre></section>
<section name="pod">
<h1 id="The_Tangle_subroutine"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">The Tangle subroutine</a></h1>
<p>This subroutine will remove all the Pod6 code from a semi-literate file (<code>.sl</code>) and keep only the Raku code.</p></section>
<section name="pod"><pre class="pod-block-code">   86| sub tangle (
</pre></section>
<section name="pod"><p>The subroutine has a single parameter, which is the input filename. The filename is required. Typically, this parameter is obtained from the command line or passed from the subroutine <code>MAIN</code>.</p></section>
<section name="pod"><pre class="pod-block-code">   87|     Str $input-file!,
</pre></section>
<section name="pod"><p>The subroutine will return a <code>Str</code>, which will be a working Raku program.</p></section>
<section name="pod"><pre class="pod-block-code">   88|         --&gt; Str ) is export {
</pre></section>
<section name="pod"><p>First we will get the entire Semi-Literate <code>.sl</code> file...</p></section>
<section name="pod"><pre class="pod-block-code">   89|     my Str $source = $input-file.IO.slurp;
</pre></section>
<section name="pod">
<h2 id="Clean_the_source"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">Clean the source</a></h2>

<h3 id="Remove_unnecessary_blank_lines"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">Remove unnecessary blank lines</a></h3>
<p>Very often the <code>code</code> section of the Semi-Literate file will have blank lines that you don't want to see in the tangled working code. For example:</p><pre class="pod-block-code">                                                # &lt;== unwanted blank lines
                                                # &lt;== unwanted blank lines
    sub foo () {
        { ... }
    } # end of sub foo ()
                                                # &lt;== unwanted blank lines
                                                # &lt;== unwanted blank lines

</pre></section>
<section name="pod"><p>So we'll remove the blank lines immediately outside the beginning and end of the Pod6 sections.</p></section>
<section name="pod"><pre class="pod-block-code">   90|     my Str $cleaned-source = $source;
   91|     $cleaned-source ~~ s:g{    \=end (\N*) \n+}      =  &quot;\=end$0\n&quot;;
   92|     $cleaned-source ~~ s:g{\n+ \=begin (&lt;hws&gt; pod) } = &quot;\n\=begin$0&quot;;
</pre></section>
<section name="pod">
<h2 id="The_interesting_stuff"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">The interesting stuff</a></h2>
<p>We parse it using the <code>Semi::Literate</code> grammar and obtain a list of submatches (that's what the <code>caps</code> method does) ...</p></section>
<section name="pod"><pre class="pod-block-code">   93|     my Pair @submatches = Semi::Literate.parse($cleaned-source).caps;
   94| 
   95|     my Str $raku-code = @submatches.map( {
</pre></section>
<section name="pod">
<h3 id="Replace_Pod6_sections_with_blank_lines"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">Replace Pod6 sections with blank lines</a></h3>
</section>
<section name="pod"><pre class="pod-block-code">   96|         when .key eq 'pod' {
   97|             my $num-blank-lines =
   98|                 .value.hash&lt;blank-line-comment&gt;&lt;num-blank-lines&gt;;
   99|             &quot;\n&quot; x $num-blank-lines with $num-blank-lines;
  100|         }
</pre></section>
<section name="pod"><p>Add all the <code>Code</code> sections.</p></section>
<section name="pod"><pre class="pod-block-code">  101|         when .key eq 'code' {
  102|             .value;
  103|         } 
  104| 
</pre></section>
<section name="pod"><p>... and we will join all the code sections together...</p></section>
<section name="pod"><pre class="pod-block-code">  105|     } 
  106|     ).join;
</pre></section>
<section name="pod">
<h3 id="Remove_the_no-weave_delimiters"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">Remove the <em>no-weave</em> delimiters</a></h3>
</section>
<section name="pod"><pre class="pod-block-code">  107|     $raku-code ~~ s:g{
  108|                         | &lt;Semi::Literate::begin-no-weave&gt;
  109|                         | &lt;Semi::Literate::end-no-weave&gt;
  110|                   } = '';
  111| 
  112|     $raku-code ~~ s:g{ &lt;Semi::Literate::one-line-no-weave&gt; }
  113|                     = &quot;$&lt;Semi::Literate::one-line-no-weave&gt;&lt;the-code&gt;\n&quot;;
</pre></section>
<section name="pod">
<h3 id="remove_blank_lines_at_the_end"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">remove blank lines at the end</a></h3>
</section>
<section name="pod"><pre class="pod-block-code">  114|     $raku-code ~~ s{\n  &lt;blank-line&gt;* $ } = '';
</pre></section>
<section name="pod"><p>And that's the end of the <code>tangle</code> subroutine!</p></section>
<section name="pod"><pre class="pod-block-code">  115|     return $raku-code;
  116| } 
</pre></section>
<section name="pod">
<h1 id="The_Weave_subroutine"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">The Weave subroutine</a></h1>
<p>The <code>Weave</code> subroutine will <em>weave</em> the <code>.sl</code> file into a readable Markdown, HTML, or other format. It is a little more complicated than <code>sub tangle</code> because it has to include the <code>code</code> sections.</p></section>
<section name="pod"><pre class="pod-block-code">  117| sub weave (
</pre></section>
<section name="pod">
<h2 id="The_parameters_of_Weave"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">The parameters of Weave</a></h2>
<p><code>sub weave</code> will have several parameters.</p>
<h3 id="$input-file"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document"><code>$input-file</code></a></h3>
<p>The input filename is required. Typically, this parameter is obtained from the command line through a wrapper subroutine <code>MAIN</code>.</p></section>
<section name="pod"><pre class="pod-block-code">  118|     Str $input-file!;
</pre></section>
<section name="pod">
<h3 id="$line-numbers"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document"><code>$line-numbers</code></a></h3>
<p>It can be useful to print line numbers in the code listing. It currently defaults to True.</p></section>
<section name="pod"><pre class="pod-block-code">  119|     Bool :l(:$line-numbers) = True;
</pre></section>
<section name="pod">
<h3 id="$verbose_Use_verbose_only_for_debugging"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document"><code>$verbose</code> Use verbose only for debugging</a></h3>
</section>
<section name="pod"><pre class="pod-block-code">  120|     Bool :v(:$verbose)      = False;
</pre></section>
<section name="pod"><p><code>sub weave</code> returns a Str.</p></section>
<section name="pod"><pre class="pod-block-code">  121|         --&gt; Str ) is export {
  122| 
  123|     my UInt $line-number = 1;
</pre></section>
<section name="pod"><p>First we will get the entire <code>.sl</code> file...</p></section>
<section name="pod"><pre class="pod-block-code">  124|     my Str $source = $input-file.IO.slurp;
</pre></section>
<section name="pod">
<h3 id="Remove_blank_lines_at_the_begining_and_end_of_the_code"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">Remove blank lines at the begining and end of the code</a></h3>
<p><strong>EXPLAIN THIS!</strong></p></section>
<section name="pod"><pre class="pod-block-code">  125|     my Str $cleaned-source = $source;
  126|     $cleaned-source ~~ s:g{    \=end (\N*) \n+}      =  &quot;\=end$0\n&quot;;
  127|     $cleaned-source ~~ s:g{\n+ \=begin (&lt;hws&gt; pod) } = &quot;\n\=begin$0&quot;;
</pre></section>
<section name="pod">
<h3 id="remove_blank_lines_at_the_end_of_the_code"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">remove blank lines at the end of the code</a></h3>
</section>
<section name="pod"><pre class="pod-block-code">  128|     $cleaned-source ~~ s{\n  &lt;blank-line&gt;* $ } = '';
</pre></section>
<section name="pod">
<h2 id="Interesting_stuff"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">Interesting stuff</a></h2>
<p>...Next, we parse it using the <code>Semi::Literate</code> grammar and obtain a list of submatches (that's what the <code>caps</code> method does) ...</p></section>
<section name="pod"><pre class="pod-block-code">  129|     my Pair @submatches = Semi::Literate.parse($cleaned-source).caps;
</pre></section>
<section name="pod"><p>...And now begins the interesting part. We iterate through the submatches and insert the <code>code</code> sections into the Pod6...</p></section>
<section name="pod"><p>This function checks if the line of code is a full line comment. If so, return False, so nothing will be printed for this line.</p><p>If it's a line of code with a comment at the end, remove the comment from the line and return True</p><p>Otherwise return True</p></section>
<section name="pod"><pre class="pod-block-code">  130|     my token full-line-comment {
  131|         $&lt;the-code&gt;=(&lt;leading-ws&gt;)
  132|         '#'
  133|         &lt;rest-of-line&gt;
  134|     } 
  135| 
  136|     my regex partial-line-comment {
  137|         $&lt;the-code&gt;=(&lt;leading-ws&gt; &lt;optional-chars&gt;)  
  138|         &lt;!after &lt;opening-quote&gt;&gt;         
  139|         '#'                              
  140|         $&lt;the-comment&gt;=&lt;-[#]&gt;*           
  141|         &lt;ws-till-EOL&gt;
  142|     } 
  143| 
  144|     sub remove-comments (Seq $lines --&gt; Seq) {
  145| 
  146|         my @retval = ();
  147|         for $lines.List -&gt; $line {
  148|             given $line {
  149|                 when /&lt;full-line-comment&gt;/ {; 
  150| 
  151|                 when /&lt;partial-line-comment&gt;/ {
  152|                     @retval.push: $&lt;partial-line-comment&gt;&lt;the-code&gt;;
  153|                 }
  154| 
  155|                 default
  156|                     { @retval.push: $line; }
  157|             } 
  158|         } 
  159| 
  160|         return @retval.Seq;
  161|     } 
  162| 
  163|     my Str $weave = @submatches.map( {
  164|         when .key eq 'pod' {
  165|             .value
  166|         } 
  167| 
  168|         when .key eq 'code' {
  169|             { qq:to/EOCB/ if .&lt;code&gt;&lt;woven&gt;; }
  170|             \=begin pod
  171|             \=begin code :lang&lt;raku&gt;
  172|              {
  173|                 $_&lt;code&gt;&lt;woven&gt;
  174|                 ==&gt; lines()
  175|                 ==&gt; remove-comments()
  176|                 ==&gt; map(
  177|                         $line-numbers
  178|                             ?? {&quot;%4s| %s\n&quot;.sprintf($line-number++, $_) }
  179|                             !! {     &quot;%s\n&quot;.sprintf(                $_) }
  180|                 )
  181|                 ==&gt; chomp() 
  182|              }
  183|             \=end code
  184|             \=end pod
  185|             EOCB
  186|         } 
  187| 
  188|     } 
  189|     ).join;
</pre></section>
<section name="pod">
<h3 id="Remove_unseemly_blank_lines"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">Remove unseemly blank lines</a></h3>
</section>
<section name="pod"><pre class="pod-block-code">  190|     my Str $non-woven-blank-lines = qq:to/EOQ/;
  191|         \=end code
  192|         \=end pod
  193|         \=begin pod
  194|         \=begin code :lang&lt;raku&gt;
  195|         EOQ
  196| 
  197|     my Regex $full-comment-blank-lines = rx[
  198|         '=begin pod'              &lt;ws-till-EOL&gt;
  199|         '=begin code :lang&lt;raku&gt;' &lt;ws-till-EOL&gt;
  200|         [&lt;leading-ws&gt; \d+ | '|'?  &lt;ws-till-EOL&gt;]*
  201|         '=end code'               &lt;ws-till-EOL&gt;
  202|         '=end pod'                &lt;ws-till-EOL&gt;
  203|     ];
  204| 
  205|     $weave ~~ s:g{ $non-woven-blank-lines | &lt;$full-comment-blank-lines&gt; } = '';
</pre></section>
<section name="pod"><p>And that's the end of the <code>weave</code> subroutine!</p></section>
<section name="pod"><pre class="pod-block-code">  206|     return $weave
  207| } 
</pre></section>
<section name="pod">
<h1 id="NAME"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">NAME</a></h1>
<p><code>Semi::Literate</code> - A semi-literate way to weave and tangle Raku/Pod6 source code.</p>
<h1 id="VERSION"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">VERSION</a></h1>
<p>This documentation refers to <code>Semi-Literate</code> version 0.0.1</p>
<h1 id="SYNOPSIS"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">SYNOPSIS</a></h1>
<pre class="pod-block-code">use Semi::Literate;
# Brief but working code example(s) here showing the most common usage(s)

# This section will be as far as many users bother reading
# so make it as educational and exemplary as possible.

</pre>
<h1 id="DESCRIPTION"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">DESCRIPTION</a></h1>

<h2 id="Influences"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">Influences</a></h2>
<p><code>Semi::Literate</code> is based on Daniel Sockwell's <a href="https://www.codesections.com/blog/weaving-raku/">Pod::Literate</a>.</p><p>Also influenced by zyedidia's &lt;Literate|https://zyedidia.github.io/literate/&gt; program. Especially the idea of not weaving some portions of the code.</p><p>A full description of the module and its features. May include numerous subsections (i.e. =head2, =head2, etc.)</p>
<h1 id="DEPENDENCIES"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">DEPENDENCIES</a></h1>
<pre class="pod-block-code">Useful::Regexes</pre>
<h1 id="BUGS_AND_LIMITATIONS"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">BUGS AND LIMITATIONS</a></h1>
<p>There are no known bugs in this module. Patches are welcome.</p>
<h1 id="AUTHOR"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">AUTHOR</a></h1>
<p>Shimon Bollinger (deoac.bollinger@gmail.com)</p>
<h1 id="LICENSE_AND_COPYRIGHT"><a href="#An_implementation_of_Semi-Literate_programming_for_Raku_with_Pod6" class="u" title="go to top of document">LICENSE AND COPYRIGHT</a></h1>
<p>Â© 2023 Shimon Bollinger. All rights reserved.</p><p>This module is free software; you can redistribute it and/or modify it under the same terms as Raku itself. See <a href="https://opensource.org/licenses/Artistic-2.0">The Artistic License 2.0</a>.</p><p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</p></section>		</div>
</div><footer><div>Rendered from <span class="path"></span></div><div>at <span class="time">2023-09-17T02:18:24Z</span></div></footer>
	</body>
</html>

